# Guide de D√©marrage Rapide - Project Echo

## üöÄ D√©ploiement Rapide (15 minutes)

### Pr√©requis

1. **Comptes:**
   - GitHub (gratuit)
   - DigitalOcean (vous avez $200 de cr√©dits)
   - Google Cloud (pour YouTube API - gratuit)

2. **Configuration YouTube API:**
   - Cr√©ez un projet sur [Google Cloud Console](https://console.cloud.google.com/)
   - Activez "YouTube Data API v3"
   - Cr√©ez des credentials OAuth 2.0 (Desktop app)
   - Obtenez un refresh token (voir guide OAuth)

### Option 1: D√©ploiement DigitalOcean App Platform (Le Plus Simple)

#### √âtape 1: Pr√©parer le Code

```bash
# Assurez-vous que tout est commit√© sur GitHub
git add .
git commit -m "Ready for deployment"
git push origin main
```

#### √âtape 2: Cr√©er l'Application

1. Allez sur [DigitalOcean App Platform](https://cloud.digitalocean.com/apps)
2. Cliquez "Create App"
3. Connectez votre compte GitHub
4. S√©lectionnez votre repository

#### √âtape 3: Configurer le Backend

**Component 1: Backend (Web Service)**
- Source: `/backend`
- Build Command: `pip install -r requirements.txt`
- Run Command: `uvicorn src.main:app --host 0.0.0.0 --port $PORT`

**Environment Variables:**
```
DATABASE_URL=<auto-generated>
S3_ACCESS_KEY=<your-spaces-key>
S3_SECRET_KEY=<your-spaces-secret>
S3_BUCKET_NAME=<your-space-name>
S3_ENDPOINT_URL=<your-region>.digitaloceanspaces.com
ENCRYPTION_KEY=<generate-random-32-chars>
CORS_ORIGINS=https://your-frontend-url.ondigitalocean.app
```

#### √âtape 4: Ajouter la Base de Donn√©es

1. Cliquez "Add Component" > "Database"
2. Type: PostgreSQL
3. Version: 15
4. La variable `DATABASE_URL` sera automatiquement ajout√©e

#### √âtape 5: Configurer le Frontend

**Component 2: Frontend (Static Site)**
- Source: `/frontend`
- Build Command: `npm install && npm run build`
- Output Directory: `dist`

**Environment Variables:**
```
VITE_API_BASE_URL=https://your-backend-url.ondigitalocean.app
```

#### √âtape 6: Cr√©er DigitalOcean Spaces

1. Allez sur [DigitalOcean Spaces](https://cloud.digitalocean.com/spaces)
2. Cr√©ez un nouveau Space
3. Notez: Access Key, Secret Key, Bucket Name, Endpoint
4. Activez CORS (Settings > CORS)

#### √âtape 7: D√©ployer

1. Cliquez "Create Resources"
2. DigitalOcean va:
   - Build le backend
   - Build le frontend
   - Cr√©er la base de donn√©es
   - D√©ployer tout automatiquement
3. Attendez 5-10 minutes
4. Vous aurez 2 URLs:
   - Backend: `https://your-backend.ondigitalocean.app`
   - Frontend: `https://your-frontend.ondigitalocean.app`

### Option 2: D√©ploiement Droplet (Plus √âconomique)

#### √âtape 1: Cr√©er un Droplet

1. Allez sur [DigitalOcean Droplets](https://cloud.digitalocean.com/droplets)
2. Cr√©ez un Droplet:
   - **Image**: Ubuntu 22.04
   - **Plan**: Basic $6/mois (1GB RAM)
   - **Region**: Choisissez la plus proche
   - **Authentication**: SSH keys

#### √âtape 2: Script de D√©ploiement Automatique

Cr√©ez et ex√©cutez ce script sur votre machine locale:

```bash
# deploy.sh
#!/bin/bash

DROPLET_IP="your-droplet-ip"
DOMAIN="your-domain.com"  # Optionnel

# Copier le script de setup sur le serveur
scp setup-server.sh root@$DROPLET_IP:/root/

# Ex√©cuter le setup
ssh root@$DROPLET_IP "bash /root/setup-server.sh"
```

Cr√©ez `setup-server.sh`:

```bash
#!/bin/bash
# setup-server.sh - Script de configuration automatique

# Mise √† jour
apt update && apt upgrade -y

# Installation des d√©pendances
apt install -y python3.11 python3.11-venv python3-pip nodejs npm nginx postgresql ffmpeg git certbot python3-certbot-nginx

# Installation pnpm
npm install -g pnpm

# Cr√©ation utilisateur
adduser --disabled-password --gecos "" projectecho
usermod -aG sudo projectecho

# Cloner le repository (remplacez par votre URL)
cd /home/projectecho
git clone https://github.com/yourusername/project-echo-orchestration.git
cd project-echo-orchestration

# Configuration Backend
cd backend
python3.11 -m venv venv
source venv/bin/activate
pip install -r requirements.txt

# Configuration Frontend
cd ../frontend
pnpm install

# Configuration PostgreSQL
sudo -u postgres psql << EOF
CREATE DATABASE projectecho;
CREATE USER projectecho WITH PASSWORD 'CHANGE_THIS_PASSWORD';
GRANT ALL PRIVILEGES ON DATABASE projectecho TO projectecho;
EOF

# Cr√©er le fichier .env backend (vous devrez le compl√©ter)
cat > backend/.env << 'ENVEOF'
DATABASE_URL=postgresql://projectecho:CHANGE_THIS_PASSWORD@localhost/projectecho
S3_ACCESS_KEY=YOUR_SPACES_KEY
S3_SECRET_KEY=YOUR_SPACES_SECRET
S3_BUCKET_NAME=YOUR_BUCKET_NAME
S3_ENDPOINT_URL=nyc3.digitaloceanspaces.com
ENCRYPTION_KEY=GENERATE_RANDOM_32_CHARS_HERE
CORS_ORIGINS=http://your-domain.com
ENVIRONMENT=production
ENVEOF

# Migrations
cd backend
source venv/bin/activate
alembic upgrade head

# Build frontend
cd ../frontend
cat > .env << 'ENVEOF'
VITE_API_BASE_URL=http://your-domain.com
ENVEOF
pnpm build

# Configuration Nginx
cat > /etc/nginx/sites-available/projectecho << 'NGINXEOF'
server {
    listen 80;
    server_name your-domain.com;

    location / {
        root /home/projectecho/project-echo-orchestration/frontend/dist;
        try_files $uri $uri/ /index.html;
    }

    location /api {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
NGINXEOF

ln -s /etc/nginx/sites-available/projectecho /etc/nginx/sites-enabled/
nginx -t
systemctl reload nginx

# Service systemd
cat > /etc/systemd/system/projectecho.service << 'SERVICEEOF'
[Unit]
Description=Project Echo Backend
After=network.target

[Service]
User=projectecho
WorkingDirectory=/home/projectecho/project-echo-orchestration/backend
Environment="PATH=/home/projectecho/project-echo-orchestration/backend/venv/bin"
ExecStart=/home/projectecho/project-echo-orchestration/backend/venv/bin/uvicorn src.main:app --host 0.0.0.0 --port 8000
Restart=always

[Install]
WantedBy=multi-user.target
SERVICEEOF

systemctl daemon-reload
systemctl enable projectecho
systemctl start projectecho

echo "‚úÖ D√©ploiement termin√©!"
echo "üìù N'oubliez pas de:"
echo "   1. Configurer le fichier backend/.env avec vos vraies valeurs"
echo "   2. Configurer le fichier frontend/.env avec votre URL backend"
echo "   3. Configurer SSL avec: certbot --nginx -d your-domain.com"
```

## Configuration Post-D√©ploiement

### 1. Acc√©der √† l'Interface

Ouvrez votre navigateur: `https://your-domain.com` ou `https://your-frontend.ondigitalocean.app`

### 2. Premi√®re Utilisation

1. **Ajouter une Cha√Æne:**
   - Allez dans "Channels" > "Add Channel"
   - Remplissez:
     - Nom de la cha√Æne
     - YouTube Channel ID (trouvable dans l'URL de votre cha√Æne)
     - OAuth Credentials (client_id, client_secret, refresh_token)

2. **Configurer le Scraping:**
   - Allez dans "Channels" > [Votre Cha√Æne] > "Configuration"
   - D√©finissez les filtres de contenu
   - Configurez le planning de publication

3. **Tester:**
   - Allez dans "Queue"
   - Le syst√®me va automatiquement scraper et traiter des vid√©os
   - Surveillez le processus

### 3. Activer Phase 2 (Quand Pr√™t)

1. **Uploader votre Musique:**
   - Settings > Music > Upload
   - Format: MP3, WAV, etc.

2. **Activer:**
   - Settings > Phase 2
   - S√©lectionnez les cha√Ænes
   - S√©lectionnez la musique
   - Cliquez "Activate"

## Commandes Utiles

### Sur le Serveur (Droplet)

```bash
# Voir les logs backend
sudo journalctl -u projectecho -f

# Red√©marrer le backend
sudo systemctl restart projectecho

# Voir les logs Nginx
sudo tail -f /var/log/nginx/error.log

# Mettre √† jour le code
cd /home/projectecho/project-echo-orchestration
git pull
cd backend && source venv/bin/activate && pip install -r requirements.txt && alembic upgrade head
cd ../frontend && pnpm install && pnpm build
sudo systemctl restart projectecho
sudo systemctl reload nginx
```

## Co√ªts

### App Platform:
- **$25/mois** = Gratuit pendant 1 an avec $200

### Droplet:
- **$11/mois** = Gratuit pendant ~18 mois avec $200

## Support

- Documentation compl√®te: `docs/DEPLOYMENT.md`
- Architecture: `docs/architecture.md`
- PRD: `docs/prd.md`

## Prochaines √âtapes

1. ‚úÖ D√©ployer (suivez Option 1 ou 2 ci-dessus)
2. ‚úÖ Configurer votre premi√®re cha√Æne
3. ‚úÖ Tester avec une vid√©o
4. ‚úÖ Monitorer via Dashboard
5. ‚úÖ Activer Phase 2 quand pr√™t

**Bon d√©ploiement ! üéâ**
